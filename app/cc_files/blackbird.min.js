/*
	Blackbird - Open Source JavaScript Logging Utility
	Author: G Scott Olson
	Web: http://blackbirdjs.googlecode.com/
	     http://www.gscottolson.com/blackbirdjs/
	Version: 1.0

	The MIT License - Copyright (c) 2008 Blackbird Project
*/(function(){function generateMarkup(){var a=[];for(type in messageTypes)a.push(['<span class="',type,'" type="',type,'"></span>'].join(""));var b=document.createElement("DIV");return b.id=IDs.blackbird,b.style.display="none",b.innerHTML=['<div class="header">','<div class="left">','<div id="',IDs.filters,'" class="filters" title="click to filter by message type">',a.join(""),"</div>","</div>",'<div class="right">','<div id="',IDs.controls,'" class="controls">','<span id="',IDs.size,'" title="contract" op="resize"></span>','<span class="clear" title="clear" op="clear"></span>','<span class="close" title="close" op="close"></span>',"</div>","</div>","</div>",'<div class="main">','<div class="left"></div><div class="mainBody">',"<ol>",cache.join(""),"</ol>",'</div><div class="right"></div>',"</div>",'<div class="footer">','<div class="left"><label for="',IDs.checkbox,'"><input type="checkbox" id="',IDs.checkbox,'" />Visible on page load</label></div>','<div class="right"></div>',"</div>"].join(""),b}function backgroundImage(){var a=document.getElementsByTagName("BODY")[0];a.currentStyle&&IE6_POSITION_FIXED&&(a.currentStyle.backgroundImage=="none"&&(a.style.backgroundImage="url(about:blank)"),a.currentStyle.backgroundAttachment=="scroll"&&(a.style.backgroundAttachment="fixed"))}function addMessage(a,b){b=b.constructor==Array?b.join(""):b;if(outputList){var c=document.createElement("LI");c.className=a,c.innerHTML=['<span class="icon"></span>',b].join(""),outputList.appendChild(c),scrollToBottom()}else cache.push(['<li class="',a,'"><span class="icon"></span>',b,"</li>"].join(""))}function clear(){outputList.innerHTML=""}function clickControl(a){a||(a=window.event);var b=a.target?a.target:a.srcElement;if(b.tagName=="SPAN")switch(b.getAttributeNode("op").nodeValue){case"resize":resize();break;case"clear":clear();break;case"close":hide()}}function clickFilter(a){a||(a=window.event);var b=a.target?a.target:a.srcElement;if(b&&b.tagName=="SPAN"){var c=b.getAttributeNode("type").nodeValue;if(a.altKey){var d=document.getElementById(IDs.filters).getElementsByTagName("SPAN"),e=0;for(entry in messageTypes)messageTypes[entry]&&e++;var f=e==1&&messageTypes[c];for(var g=0;d[g];g++){var h=d[g].getAttributeNode("type").nodeValue;d[g].className=f||h==c?h:h+"Disabled",messageTypes[h]=f||h==c}}else messageTypes[c]=!messageTypes[c],b.className=messageTypes[c]?c:c+"Disabled";var i=[];for(c in messageTypes)messageTypes[c]||i.push(c);i.push(""),outputList.className=i.join("Hidden "),scrollToBottom()}}function clickVis(a){a||(a=window.event);var b=a.target?a.target:a.srcElement;state.load=b.checked,setState()}function scrollToBottom(){outputList.scrollTop=outputList.scrollHeight}function isVisible(){return bbird.style.display=="block"}function hide(){bbird.style.display="none"}function show(){var a=document.getElementsByTagName("BODY")[0];a.removeChild(bbird),a.appendChild(bbird),bbird.style.display="block"}function reposition(a){if(a===undefined||a==null)a=state&&state.pos===null?1:(state.pos+1)%4;switch(a){case 0:classes[0]="bbTopLeft";break;case 1:classes[0]="bbTopRight";break;case 2:classes[0]="bbBottomLeft";break;case 3:classes[0]="bbBottomRight"}state.pos=a,setState()}function resize(a){if(a===undefined||a===null)a=state&&state.size==null?0:(state.size+1)%2;classes[1]=a===0?"bbSmall":"bbLarge";var b=document.getElementById(IDs.size);b.title=a===1?"small":"large",b.className=b.title,state.size=a,setState(),scrollToBottom()}function setState(){var a=[];for(entry in state){var b=state[entry]&&state[entry].constructor===String?'"'+state[entry]+'"':state[entry];a.push(entry+":"+b)}a=a.join(",");var c=new Date;c.setDate(c.getDate()+14),document.cookie=["blackbird={",a,"}; expires=",c.toUTCString(),";"].join("");var d=[];for(word in classes)d.push(classes[word]);bbird.className=d.join(" ")}function getState(){var re=new RegExp(/blackbird=({[^;]+})(;|\b|$)/),match=re.exec(document.cookie);return match&&match[1]?eval("("+match[1]+")"):{pos:null,size:null,load:null}}function readKey(a){a||(a=window.event);var b=113;if(a&&a.keyCode==b){var c=isVisible();c&&a.shiftKey&&a.altKey?clear():c&&a.shiftKey?reposition():!a.shiftKey&&!a.altKey&&(c?hide():show())}}function addEvent(a,b,c){var a=a.constructor===String?document.getElementById(a):a;a.attachEvent?(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c])):a.addEventListener(b,c,!1)}function removeEvent(a,b,c){var a=a.constructor===String?document.getElementById(a):a;a.detachEvent?(a.detachEvent("on"+b,a[b+c]),a[b+c]=null):a.removeEventListener(b,c,!1)}var NAMESPACE="log",IE6_POSITION_FIXED=!0,bbird,outputList,cache=[],state=getState(),classes={},profiler={},IDs={blackbird:"blackbird",checkbox:"bbVis",filters:"bbFilters",controls:"bbControls",size:"bbSize"},messageTypes={debug:!0,info:!0,warn:!0,error:!0,profile:!0};window[NAMESPACE]={toggle:function(){isVisible()?hide():show()},resize:function(){resize()},clear:function(){clear()},move:function(){reposition()},debug:function(a){addMessage("debug",a)},warn:function(a){addMessage("warn",a)},info:function(a){addMessage("info",a)},error:function(a){addMessage("error",a)},profile:function(a){var b=new Date;return a==undefined||a==""?addMessage("error","<b>ERROR:</b> Please specify a label for your profile statement"):profiler[a]?(addMessage("profile",[a,": ",b-profiler[a],"ms"].join("")),delete profiler[a]):(profiler[a]=b,addMessage("profile",a)),b}},addEvent(window,"load",function(){var a=document.getElementsByTagName("BODY")[0];bbird=a.appendChild(generateMarkup()),outputList=bbird.getElementsByTagName("OL")[0],backgroundImage(),addEvent(IDs.checkbox,"click",clickVis),addEvent(IDs.filters,"click",clickFilter),addEvent(IDs.controls,"click",clickControl),addEvent(document,"keyup",readKey),resize(state.size),reposition(state.pos),state.load&&(show(),document.getElementById(IDs.checkbox).checked=!0),scrollToBottom(),window[NAMESPACE].init=function(){show(),window[NAMESPACE].error(["<b>",NAMESPACE,"</b> can only be initialized once"])},addEvent(window,"unload",function(){removeEvent(IDs.checkbox,"click",clickVis),removeEvent(IDs.filters,"click",clickFilter),removeEvent(IDs.controls,"click",clickControl),removeEvent(document,"keyup",readKey)})})})();